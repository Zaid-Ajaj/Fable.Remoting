
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Logging Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-enhanced-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="change-log.html" />
    
    
    <link rel="prev" href="docs.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="basics.html">
            
                <a href="basics.html">
            
                    
                    Getting Started
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Setup Server</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="suave.html">
            
                <a href="suave.html">
            
                    
                    Setup Suave
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="aspnet-core.html">
            
                <a href="aspnet-core.html">
            
                    
                    Setup Asp.NET Core
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="giraffe.html">
            
                <a href="giraffe.html">
            
                    
                    Setup Giraffe
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="saturn.html">
            
                <a href="saturn.html">
            
                    
                    Setup Saturn
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Setup Client</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="client.html">
            
                <a href="client.html">
            
                    
                    Setup Fable Client
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Dotnet Client</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="dotnet-client.html">
            
                <a href="dotnet-client.html">
            
                    
                    Getting Started from .NET
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="dotnet-csharp.html">
            
                <a href="dotnet-csharp.html">
            
                    
                    C# Support
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="dotnet-integration-tests.html">
            
                <a href="dotnet-integration-tests.html">
            
                    
                    Asp.NET Core Integration Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="dotnet-client-limitations.html">
            
                <a href="dotnet-client-limitations.html">
            
                    
                    Limitations and Workaround
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Advanced</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="route-builder.html">
            
                <a href="route-builder.html">
            
                    
                    Custom Route Paths
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="error-handling.html">
            
                <a href="error-handling.html">
            
                    
                    Error Handling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="modeling-authentication.html">
            
                <a href="modeling-authentication.html">
            
                    
                    Modeling Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="implicit-authentication.html">
            
                <a href="implicit-authentication.html">
            
                    
                    Implicit Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="request-context.html">
            
                <a href="request-context.html">
            
                    
                    Accessing Request Context
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="raw-http.html">
            
                <a href="raw-http.html">
            
                    
                    Raw Http Communication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="docs.html">
            
                <a href="docs.html">
            
                    
                    Type-Safe Documentation
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="5.8" data-path="logging.html">
            
                <a href="logging.html">
            
                    
                    Logging
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Misc</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="change-log.html">
            
                <a href="change-log.html">
            
                    
                    Changelog
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="migrate.html">
            
                <a href="migrate.html">
            
                    
                    Migratiion 2.x to 3.x
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="troubleshoot.html">
            
                <a href="troubleshoot.html">
            
                    
                    Troubleshooting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="credits.html">
            
                <a href="credits.html">
            
                    
                    Credits
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Logging</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="logging">Logging</h1>
<p>Logging is dead-simple to integrate with <code>Fable.Remoting</code>, if you are using Suave, then <a href="https://github.com/Zaid-Ajaj/Suave.SerilogExtensions" target="_blank">Suave.SerilogExtensions</a> is what we recommend to use where <a href="https://github.com/Zaid-Ajaj/Suave.SerilogExtensions" target="_blank">Serilog</a> is the logging framework of choice.</p>
<blockquote>
<p>Suave.SerilogExtensions is specially written to work with Fable.Remoting, although it would work just great with any Suave app.
Logging extensions for Giraffe/Saturn are not yet available.</p>
</blockquote>
<h2 id="basic-use-case">Basic use case</h2>
<p>1 - Install from Nuget:</p>
<pre><code class="lang-bash">dotnet add package Suave.SerilogExtensions
<span class="hljs-comment"># or if you are using paket</span>
mono .paket/paket.exe add Suave.SerilogExtensions
</code></pre>
<p>2 - Wrap your <code>remoting</code> WebPart with the Serilog adapter:</p>
<pre><code class="lang-fs"><span class="hljs-keyword">open</span> System
<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">open</span> Suave.SerilogExtensions
<span class="hljs-keyword">open</span> Suave  

<span class="hljs-comment">// Log unhandled exceptions </span>
<span class="hljs-keyword">let</span> errorHandler (ex: Exception)  
                 (routeInfo: RouteInfo&lt;HttpContext&gt;) =
    <span class="hljs-comment">// get a contextual logger with RequestId attached to it</span>
    <span class="hljs-keyword">let</span> contextLogger = routeInfo.httpContext.Logger()
    <span class="hljs-comment">// log the exception with relevant data</span>
    <span class="hljs-keyword">let</span> errorMsgTemplate = <span class="hljs-string">&quot;Error occured while invoking {MethodName} at {RoutePath}&quot;</span>
    contextLogger.Error(ex, errorMsgTemplate, routeInfo.methodName, routeInfo.path)
    <span class="hljs-comment">// No need to propagate custom errors back to client</span>
    Ignore 


<span class="hljs-comment">// create the WebPart</span>
<span class="hljs-keyword">let</span> webApp : WebPart = 
    Remoting.createApi()
    |&gt; Remoting.fromValue musicStore
    |&gt; Remoting.withRouteBuilder (sprintfn <span class="hljs-string">&quot;/api/%s/%s&quot;</span>) 
    |&gt; Remoting.withErrorHandler errorHandler 
    |&gt; Remoting.buildWebPart

<span class="hljs-comment">// Enable logging</span>
<span class="hljs-keyword">let</span> webAppWithLogging : WebPart = SerilogAdapter.Enable(webApp)
</code></pre>
<p>3 - Create the logger and configure the sinks:</p>
<pre><code class="lang-fs"><span class="hljs-comment">// configure Serilog</span>
Log.Logger &lt;- 
    LoggerConfiguration() 
      <span class="hljs-comment">// Suave.SerilogExtensions has native destructuring mechanism</span>
      <span class="hljs-comment">// this helps Serilog deserialize the fsharp types like unions/records</span>
      .Destructure.FSharpTypes()
      <span class="hljs-comment">// use package Serilog.Sinks.Console  </span>
      <span class="hljs-comment">// https://github.com/serilog/serilog-sinks-console</span>
      .WriteTo.Console() 
      <span class="hljs-comment">// add more sinks etc.</span>
      .CreateLogger()
</code></pre>
<p>4 - Start the web server</p>
<pre><code>startWebServer defaultConfig webAppWithLogging
</code></pre><p><a href="https://github.com/Zaid-Ajaj/Suave.SerilogExtensions" target="_blank">Suave.SerilogExtensions</a> contains many configuration options that you might want to check out. </p>
<h2 id="using-logger-from-remoting-functions">Using logger from remoting functions</h2>
<p>Ofcourse, we don&apos;t want to just log the http requests and responses but we also want to log application specific and custom logs. To use Serilog from the remote functions, you need to access to <code>HttpContext</code> and call <code>httpContext.Logger()</code> to get a contexual logger you can log events from. </p>
<blockquote>
<p>Logger() is an extension method provided from Suave.SerilogExtensions</p>
</blockquote>
<p>Suppose your protocol had the type:</p>
<pre><code class="lang-fs"><span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">IMusicStore</span> </span>= {
    albums : Async&lt;list&lt;Album&gt;&gt;
}
</code></pre>
<p>To gain access to the <code>HttpContext</code>, use it as a parameter to end up with <code>HttpContext -&gt; IMusicStore</code>:</p>
<pre><code class="lang-fs"><span class="hljs-comment">// The musicStore value is dependent on the context</span>
<span class="hljs-keyword">let</span> musicStore (httpContext: HttpContext) : IMusicStore = {
    albums = async {
        <span class="hljs-keyword">let</span> logger = httpContext.Logger()
        logger.Information(<span class="hljs-string">&quot;Retrieving albums from database&quot;</span>)
        <span class="hljs-keyword">let!</span> albums = Database.getAllAlbums()
        logger.Information(<span class="hljs-string">&quot;Read {AlbumCount} albums from database&quot;</span>, List.length albums)
        <span class="hljs-keyword">return</span> albums
    }
} 

<span class="hljs-comment">// create the WebPart using &apos;fromContext&apos; instead of &apos;fromValue&apos; to gain access to the context</span>
<span class="hljs-keyword">let</span> webApp : WebPart = 
    Remoting.createApi()
    |&gt; Remoting.fromContext musicStore
    |&gt; Remoting.withRouteBuilder (sprintfn <span class="hljs-string">&quot;/api/%s/%s&quot;</span>) 
    |&gt; Remoting.withErrorHandler errorHandler 
    |&gt; Remoting.buildWebPart

<span class="hljs-comment">// Wrap with Serilog adapter</span>
<span class="hljs-keyword">let</span> webAppWithLogging = SerilogAdapter.Enable(webApp)

startWebServer defaultConfig webAppWithLogging
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="docs.html" class="navigation navigation-prev " aria-label="Previous page: Type-Safe Documentation">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="change-log.html" class="navigation navigation-next " aria-label="Next page: Changelog">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Logging","level":"5.8","depth":1,"next":{"title":"Changelog","level":"6.1","depth":1,"path":"src/change-log.md","ref":"src/change-log.md","articles":[]},"previous":{"title":"Type-Safe Documentation","level":"5.7","depth":1,"path":"src/docs.md","ref":"src/docs.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["enhanced-katex"],"pluginsConfig":{"enhanced-katex":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css"}},"file":{"path":"src/logging.md","mtime":"2018-07-13T11:18:25.597Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-10-07T17:54:04.238Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

